# Lagari Vision System - Default Configuration
# ============================================

# Logging
logging:
  level: info                    # trace, debug, info, warn, error, critical
  file: /var/log/lagari/vision.log
  console: true
  file_level: debug

# System
system:
  target_fps: 30                 # Target processing framerate
  max_latency_ms: 50             # Maximum acceptable latency
  state_machine:
    initial_state: idle          # idle, searching
    auto_start: false            # Start processing on boot

# Capture
capture:
  source: auto                   # auto, csi, usb, file, rtsp, simulation, isaac
  width: 1280
  height: 720
  fps: 30
  format: bgr24                  # bgr24, rgb24, nv12
  device: ""                     # Device path or ID (auto-detect if empty)
  camera_id: 0
  
  # Buffer settings
  buffer_count: 4
  drop_frames: true
  
  # Image adjustments
  auto_exposure: true
  flip_horizontal: false
  flip_vertical: false
  rotation: 0                    # 0, 90, 180, 270
  
  # File/simulation source
  file_path: ""
  loop_file: true
  
  # Isaac Sim settings (when source: isaac)
  isaac:
    shm_name: lagari_camera        # Shared memory segment name  
    poll_interval_us: 100          # Polling interval (microseconds)
    reconnect: true                # Auto-reconnect if detached
    reconnect_delay_ms: 1000       # Delay before reconnect attempt

  # NVIDIA Argus settings (Jetson CSI cameras)
  argus:
    sensor_mode: 0                 # Sensor mode index
    denoise: true                  # Enable denoising
    denoise_strength: 0.5          # Denoise strength (0-1)
    edge_enhance: true             # Enable edge enhancement
    edge_enhance_strength: 0.5     # Edge enhance strength (0-1)
    awb: true                      # Auto white balance

  # libcamera settings (Raspberry Pi cameras)
  libcamera:
    ae_enable: true                # Auto exposure
    exposure_us: 0                 # Manual exposure (0 = auto)
    gain: 1.0                      # Analogue gain
    awb: true                      # Auto white balance
    brightness: 0.0                # Brightness (-1 to 1)
    contrast: 1.0                  # Contrast (0 to 2)
    saturation: 1.0                # Saturation (0 to 2)
    sharpness: 1.0                 # Sharpness (0 to 2)
    denoise: 2                     # 0=off, 1=fast, 2=high quality

  # GStreamer settings (for file, rtsp, gstreamer sources)
  gstreamer:
    source_type: auto              # auto, v4l2, rtsp, file, http, test, uri, argus, libcamera
    pipeline: ""                   # Custom pipeline (overrides other settings)
    uri: ""                        # URI for rtsp/http/file sources
    latency_ms: 200                # RTSP latency/buffer
    tcp_timeout: 5000000           # Connection timeout (Âµs)
    use_tcp: true                  # Use TCP for RTP transport
    drop_on_latency: true          # Drop frames if behind
    hw_decode: true                # Use hardware decoding
    decoder: ""                    # Specific decoder (empty = auto)
    sync: false                    # Sync to clock
    queue_size: 2                  # AppSink buffer size

# Detection
detection:
  backend: auto                  # auto, tensorrt, hailo, ncnn, openvino
  yolo_version: yolov8           # yolov5, yolov7, yolov8, yolov9, yolov10, yolo11
  
  model_path: models/yolov8n.engine
  labels_path: models/coco.names
  
  input_width: 640
  input_height: 640
  
  confidence_threshold: 0.5
  nms_threshold: 0.45
  max_detections: 100
  
  # Target classes (empty = all)
  # For UAV detection, you might want specific classes
  target_classes: []
  
  # Performance tuning
  fp16: true
  int8: false
  batch_size: 1
  dla_core: -1                   # -1 = disabled

  # OpenVINO-specific settings
  openvino:
    device: CPU                  # CPU, GPU, AUTO

  # NCNN-specific settings
  ncnn:
    threads: 4                   # Number of threads
    vulkan: false                # Use Vulkan GPU acceleration

  # ONNX Runtime-specific settings
  onnxruntime:
    provider: cuda                # cpu, cuda, tensorrt, directml, coreml
    device_id: 0                 # Device ID for GPU providers

# QR Decoding
qr:
  enabled: true
  qr_class_id: -1                # Class ID for QR codes (-1 = no detection filter)
  decode_full_frame: false       # Try decoding full frame if no QR detected
  
  # Multi-attempt decoding
  max_attempts: 3
  preprocessing:
    - none
    - sharpen
    - adaptive_threshold
  
  # Result caching
  cache_ttl_ms: 1000             # Cache results for 1 second

# Guidance
guidance:
  enabled: true
  algorithm: pid                 # pid, mpc, custom
  target_class_id: 0             # Class ID to track
  
  # PID gains
  pid:
    roll:
      kp: 0.5
      ki: 0.01
      kd: 0.1
    pitch:
      kp: 0.5
      ki: 0.01
      kd: 0.1
    yaw:
      kp: 0.3
      ki: 0.0
      kd: 0.05
  
  # Safety limits
  max_roll_deg: 15.0
  max_pitch_deg: 15.0
  max_yaw_rate_dps: 30.0
  
  # Control rate
  update_rate_hz: 50

# Autopilot Communication
autopilot:
  enabled: true
  connection: udp://:14540       # MAVLink connection string
  # Alternatives:
  # - serial:///dev/ttyTHS1:921600
  # - tcp://127.0.0.1:5760
  
  system_id: 1
  component_id: 196              # MAV_COMP_ID_USER1
  
  heartbeat_interval_ms: 1000
  timeout_ms: 5000
  
  # Command mode
  offboard_mode: attitude        # attitude, velocity, position

# Telemetry (to GCS)
telemetry:
  enabled: true
  host: 0.0.0.0
  port: 5600
  
  # Data telemetry
  data:
    enabled: true
    port: 5601
    rate_hz: 10
  
  # Video streaming
  video:
    enabled: true
    port: 5602
    codec: h264
    bitrate_kbps: 2000
    gop: 30

# Display
display:
  enabled: false                 # Set to true to enable live display
  target: window                 # window, rtsp, udp, custom
  
  # Window settings
  window_name: Lagari Vision
  fullscreen: false
  
  # Streaming settings (for rtsp/udp targets)
  host: 0.0.0.0
  port: 5700
  bitrate_kbps: 2000
  
  # Custom pipeline (overrides target if not empty)
  pipeline: ""
  
  # Overlay
  overlay:
    enabled: true
    timestamp: true
    bounding_boxes: true
    state: true
    latency: true
  
  # Performance
  max_fps: 30
  drop_frames: true
  codec: h264                    # h264, mjpeg
  hw_encode: true                # Use hardware encoding for streaming

# Recording
recording:
  enabled: false                 # Set to true to enable recording
  output_dir: /var/lagari/recordings
  
  # Encoding settings
  codec: h264                    # h264, h265
  bitrate_kbps: 8000
  fps: 30
  hw_encode: true                # Use hardware encoding if available
  
  # Container format
  container: mp4                 # mp4, mkv, ts
  
  # Overlay
  overlay:
    enabled: true
    timestamp: true
    bounding_boxes: true
    state: true
    latency: true
  
  # File management
  segment_duration_s: 0          # 0 = single file, >0 = split into segments
  max_storage_gb: 10
  delete_oldest: true

# Performance monitoring
performance:
  enabled: true
  log_interval_s: 10
  
  # Telemetry export
  export_to_gcs: false
  
  # Alerts
  alerts:
    high_latency_ms: 100
    low_fps: 15
    high_cpu_percent: 80
    high_memory_percent: 80

